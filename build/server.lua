local a=require("socket")local b=require("ssl.https")local c=require("socket.url")local d=require("mime")function get_file_data(e)local f,g=io.open(e,'rb')print(g,e)if f==nil then return"<!DOCTYPE html><html><head><title>404 Not Found</title></head><body><h1>404 Not Found</h1><p>The requested page could not be found.</p></body></html>"end;local h=f:read("*all")f:close()return h end;function GetFileName(c)local i=c;local j=""local k=""for l=i:len(),1,-1 do if i:sub(l,l)~="/"then j=j..i:sub(l,l)else break end end;for m=j:len(),1,-1 do k=k..j:sub(m,m)end;return k end;function GetFileExtension(c)local i=c;local j=""local k="."for l=i:len(),1,-1 do if i:sub(l,l)~="."then j=j..i:sub(l,l)else break end end;for m=j:len(),1,-1 do k=k..j:sub(m,m)end;return k end;local n=8080;local o=assert(a.bind("*",n))print("Server running at http://localhost:"..n.."/")local p;local q="HTTP/1.1 200 OK\r\nContent-Type: "function serve_GET(r)local f=GetFileName(r)local s=""local t=GetFileExtension(f)if t:find(".pdf")then s="application/pdf"elseif t:find(".html")then s="text/html"elseif t:find(".css")then s="text/css"elseif t:find(".js")then s="text/javascript"elseif t:find(".wasm")then s="application/wasm"elseif t:find(".exit")then local u="<!DOCTYPE html><html><head><title>503 Shutting down</title></head><body><h1>503 Shutting down</h1><p>The server is shutting down now.</p></body></html>"local v=q.."\r\nContent-Length: "..u:len().."\r\n\r\n"..u;p:send(v)p:close()os.exit(0)end;print(r:sub(2))local w=get_file_data(r:sub(2))s=s.."\r\nContent-Length: "..w:len().."\r\n\r\n"local v=q..s..w;print(q..s)return v end;function decode_req(h)local x='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'h=string.gsub(h,'[^'..x..'=]','')return h:gsub('.',function(y)if y=='='then return''end;local z,A='',x:find(y)-1;for l=6,1,-1 do z=z..(A%2^l-A%2^(l-1)>0 and'1'or'0')end;return z end):gsub('%d%d%d?%d?%d?%d?%d?%d?',function(y)if#y~=8 then return''end;local B=0;for l=1,8 do B=B+(y:sub(l,l)=='1'and 2^(8-l)or 0)end;return string.char(B)end)end;function serve_POST(r)print("Didn't know, we also did post requests. Bummer.")return"HTTP/1.1 200 OK\r\n"end;while true do p,err=o:accept()if p then local C,err=p:receive()if C then local r=c.parse(C,{path=true}).path;print(r)local v=""if string.find(r,"GET ")then v=serve_GET(string.sub(r,string.find(r,"GET ")+string.len("GET "),string.find(r," HTTP/1.1")-1))elseif string.find(r,"POST ")then v=serve_POST(string.sub(r,string.find(r,"POST ")+string.len("POST "),string.find(r," HTTP/1.1")-1))end;p:send(v)end;p:close()end end